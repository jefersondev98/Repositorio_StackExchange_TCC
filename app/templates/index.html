{% extends 'layout.html' %}
{% block title %} StackMetadata | Home {% endblock title %}
{% block head %}
  {{ super() }}
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{{ url_for('static', filename='plugins/fontawesome-free/css/all.min.css') }}">
  <!-- Select2 -->
  <link rel="stylesheet" href="{{ url_for('static', filename='plugins/select2/css/select2.min.css') }}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{{ url_for('static', filename='dist/css/adminlte.min.css') }}">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="{{ url_for('static', filename='plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css') }}">
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="{{ url_for('static', filename='plugins/icheck-bootstrap/icheck-bootstrap.min.css') }}">
  <!-- DataTables -->
  <link rel="stylesheet" href="{{ url_for('static', filename='plugins/datatables-bs4/css/dataTables.bootstrap4.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='plugins/datatables-responsive/css/responsive.bootstrap4.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='plugins/datatables-buttons/css/buttons.bootstrap4.min.css') }}">
{% endblock head %}
{% block section_content %}
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
  {% if current_user.role == "administrator"%}
    <!-- Main content -->
    <section class="content">
      <div class="container-fluid mt-3">
        <!-- Small boxes (Stat box) -->
        <div class="row">
          <div class="col-lg-6 col-6">
            <!-- small box -->
            <div class="small-box bg-info">
              <div class="inner">
                <h3>{{ number_sites }}</h3>

                <p>Fóruns</p>
              </div>
              <div class="icon">
                <i class="fas fa-link"></i>
              </div>
              <a href="{{ url_for('view_sites') }}" class="small-box-footer">Mais Informações <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <div class="col-lg-6 col-6">
            <!-- small box -->
            <div class="small-box bg-success">
              <div class="inner">
                <h3>{{ number_learning_objects }}</h3>

                <p>Objetos de Aprendizagem</p>
              </div>
              <div class="icon">
                <i class="fab fa-stack-overflow"></i>
              </div>
              <a href="{{ url_for('view_learning_objects') }}" class="small-box-footer">Mais Informações <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
        </div>
      </section>
      <!-- /.content -->
    {% endif %}

  <!-- Content Header (Page header) -->
  <section class="content-header border-bottom">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1>Busca de Objetos de Aprendizagem na Base de Dados</h1>
        </div>
      </div>
    </div><!-- /.container-fluid -->
  </section>
  <!-- Main content -->
  <section class="content">
    <div class="container-fluid mt-5 mb-5">
      <form action="{{ url_for('results_search_database') }}" method="post">
        <div class="row">
          <div class="col-md-10 offset-md-1">                        
            <div class="row">                        
              <div class="col-3">
                <!-- Date -->
                <div class="form-group">
                  <label>Data início:</label>
                  <div class="input-group date" id="reservationdate_start" data-target-input="nearest">
                    <input name="date_start" type="text" required="required" class="form-control datetimepicker-input" data-target="#reservationdate_start" placeholder="dd/mm/aaaa" value="{{ date_start }}"/>
                    <div class="input-group-append" data-target="#reservationdate_start" data-toggle="datetimepicker">
                      <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <!-- Date -->
                <div class="form-group">
                  <label>Data fim:</label>
                  <div class="input-group date" id="reservationdate_end" data-target-input="nearest">
                    <input name="date_end" type="text" required="required" class="form-control datetimepicker-input" data-target="#reservationdate_end" placeholder="dd/mm/aaaa" value="{{ date_end }}"/>
                    <div class="input-group-append" data-target="#reservationdate_end" data-toggle="datetimepicker">
                      <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div>
                  </div>
                </div>
              </div>   
              <div class="col-3">
                <div class="form-group">
                  <label>Ordenar em:</label>
                  <select name="selected-order" class="form-control" style="width: 100%;">                                        
                    <option>Decrescente</option>
                    <option>Crescente</option>
                  </select>
                </div>
              </div>                                                          
            </div>
            <div class="row">
              <div class="col-3">
                <div class="form-group">
                  <label>Com as palavras-chaves:</label>
                  <select id="selected-tagged" name="selected-tagged" class="create-tags select2" multiple="multiple" data-placeholder="Todas" style="width: 100%;">
                    <option></option>
                  </select>                                    
                </div>
              </div>
              <div class="col-9">
                <div class="form-group">
                  <label>Fóruns de origem:</label>
                  <select name="selected-sites" class="select2" multiple="multiple" data-placeholder="Todos" style="width: 100%;">
                  {% if sites %}
                    {% for site in sites %}
                      <option>{{ site['name'] | safe }}-{{ site['api_parameter'] }}</option>
                    {% endfor %}
                  {% endif %}
                  </select>
                  <small id="passwordHelpInline" class="text-muted">
                    Atenção! Ao pesquisar por todos os fóruns ao mesmo tempo a pesquisa pode demorar um pouco!
                  </small>
                </div>
              </div> 
            </div>
            <div class="row align-items-end">
              <!-- select -->                
              <div class="col-3 form-group">
                <label>Pesquisar por:</label>
                <select name="selected-type-search" class="form-control">
                  <option>Título</option>
                  <option>Descrição</option>
                  <option>Autor</option>
                  <option>Idioma</option>
                </select>
              </div>   
              <div class="col-9 form-group">
                <div class="input-group">
                  <input name="search" type="search" class="form-control" placeholder="Digite o que está procurando aqui" aria-label="Search">
                  <div class="input-group-append">
                    <button type="submit" class="btn btn-default">
                      <i class="fa fa-search"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>                                                
          </div>
        </div>
      </form>
    </div>
  </section>

  <!-- Main content -->
  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Ultimos 10 Objetos de Aprendizagem armazenados no Banco de Dados</h3>
            </div>
            <!-- /.card-header -->
            {% if learning_objects %}
              <div class="card-body">
                <table id="data-table" class="table table-bordered table-striped">
                  <thead>
                  <tr>
                    <th>Ação</th>
                    <th>Fórum</th>
                    <th>Título</th>
                    <th>Tags</th>
                    <th>URL</th>
                  </tr>
                  </thead>
                  <tbody>
                    {% for learning_object in learning_objects %}
                      <tr>
                        <td class="btn-group">
                          <a href="{{ url_for('view_learning_object', id_learning_object_0=learning_object['general']['identifier'][0],id_learning_object_1=learning_object['general']['identifier'][1]) }}" class="btn btn-info btn-icon-split">
                            <span class="icon text-white-50">
                                <i class="fas fa-eye"></i>
                            </span>
                            <span class="text">Visualizar</span>
                          </a>
                          {% if current_user.role == "administrator" %}
                            <a href="{{ url_for('edit_learning_object', id_learning_object_0=learning_object['general']['identifier'][0],id_learning_object_1=learning_object['general']['identifier'][1]) }}" class="btn btn-warning btn-icon-split">
                              <span class="icon text-white-50">
                                  <i class="fas fa-edit"></i>
                              </span>
                              <span class="text">Editar</span>
                            </a>
                            <a href="{{ url_for('delete_learning_object', id_learning_object_0=learning_object['general']['identifier'][0],id_learning_object_1=learning_object['general']['identifier'][1]) }}" class="btn btn-danger btn-icon-split">
                              <span class="icon text-white-50">
                                  <i class="fas fa-trash-alt"></i>
                              </span>
                              <span class="text">Deletar</span>
                            </a>
                          {% endif %}
                        </td>
                        <td>{{ learning_object['general']['identifier'][0] | safe }}</td>
                        <td>{{ learning_object['general']['title'] | safe }}</td>
                        <td>{{ learning_object['general']['catalog_entry']['catalogue'] | safe }}</td>
                        <td><a href="{{ learning_object['general']['catalog_entry']['entry'] }}" target="_blank">{{ learning_object['general']['catalog_entry']['entry'] }}</a></td>
                      </tr>
                    {% endfor %}
                  </tbody>
                  <tfoot>
                  <tr>
                    <th>Ação</th>
                    <th>Fórum</th>
                    <th>Título</th>
                    <th>Tags</th>
                    <th>URL</th>
                  </tr>
                  </tfoot>
                </table>
              </div>
            {% endif %}
            <!-- /.card-body -->
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
  </section>
  <!-- /.content -->
</div>
<!-- /.content-wrapper -->
{% endblock section_content %}
{% block scripts %}
  {{ super() }}
  <!-- Select2 -->
  <script src="{{ url_for('static', filename='plugins/select2/js/select2.full.min.js') }}"></script>
  <!-- InputMask -->
  <script src="{{ url_for('static', filename='plugins/moment/moment-with-locales.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/inputmask/jquery.inputmask.min.js') }}"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script src="{{ url_for('static', filename='plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js') }}"></script>
  <script>
    $(function () {
      //Initialize Select2 Elements
      $('.select2').select2()
      //Create tags in select2
      $(".create-tags").select2({
        tags: true,
        tokenSeparators: [',', ';', '.']
      });
      //Date picker
      $('#reservationdate_start').datetimepicker({
        locale: 'pt-br',
        format: 'DD/MM/YYYY'
      });
      $('#reservationdate_end').datetimepicker({
        useCurrent: false,
        locale: 'pt-br',
        format: 'L'
      });
      //Linked Date picker
      $("#reservationdate_start").on("change.datetimepicker", function (e) {
          $('#reservationdate_end').datetimepicker('minDate', e.date);
      });
      $("#reservationdate_end").on("change.datetimepicker", function (e) {
          $('#reservationdate_start').datetimepicker('maxDate', e.date);
      });
    });
  </script>
  <!-- DataTables  & Plugins -->
  <script src="{{ url_for('static', filename='plugins/datatables/jquery.dataTables.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-bs4/js/dataTables.bootstrap4.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-responsive/js/dataTables.responsive.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-responsive/js/responsive.bootstrap4.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-buttons/js/dataTables.buttons.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-buttons/js/buttons.bootstrap4.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/jszip/jszip.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/pdfmake/pdfmake.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/pdfmake/vfs_fonts.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-buttons/js/buttons.html5.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-buttons/js/buttons.print.min.js') }}"></script>
  <script src="{{ url_for('static', filename='plugins/datatables-buttons/js/buttons.colVis.min.js') }}"></script>
  <!-- Page specific script -->
  <script>
    $(function () {
      $("#data-table").DataTable({
        "responsive": true, "lengthChange": false, "autoWidth": false,
        "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
      }).buttons().container().appendTo('#data-table_wrapper .col-md-6:eq(0)');
    });
  </script>
{% endblock scripts %}
